<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„€è¡¨æ¿åŠŸèƒ½æ¼”ç¤º - é‹’å…„AIè³‡è¨Šç³»çµ±</title>
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/components.css">
    <link rel="stylesheet" href="src/styles/dashboard.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 2rem;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .demo-header h1 {
            color: #1f2937;
            margin: 0 0 1rem 0;
            font-size: 2.5rem;
        }
        
        .demo-header p {
            color: #6b7280;
            font-size: 1.1rem;
            margin: 0;
        }
        
        .demo-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .demo-status {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #3b82f6;
        }
        
        .status-loading {
            border-left-color: #f59e0b;
        }
        
        .status-success {
            border-left-color: #10b981;
        }
        
        .status-error {
            border-left-color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>ğŸ¯ å„€è¡¨æ¿åŠŸèƒ½æ¼”ç¤º</h1>
            <p>å±•ç¤ºé‹’å…„AIè³‡è¨Šç³»çµ±çš„å„€è¡¨æ¿çµ±è¨ˆã€æé†’å’Œæ•¸æ“šç®¡ç†åŠŸèƒ½</p>
        </div>
        
        <div class="demo-controls">
            <button class="btn btn-primary" onclick="loadTestData()">ğŸ“Š è¼‰å…¥æ¸¬è©¦æ•¸æ“š</button>
            <button class="btn btn-secondary" onclick="refreshDashboard()">ğŸ”„ åˆ·æ–°å„€è¡¨æ¿</button>
            <button class="btn btn-success" onclick="runTests()">ğŸ§ª åŸ·è¡Œæ¸¬è©¦</button>
            <button class="btn btn-secondary" onclick="exportReport()">ğŸ“‹ å°å‡ºå ±å‘Š</button>
        </div>
        
        <div id="demo-status" class="demo-status">
            <strong>ç‹€æ…‹:</strong> æº–å‚™å°±ç·’ï¼Œè«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¼”ç¤º
        </div>
        
        <!-- å„€è¡¨æ¿å…§å®¹ -->
        <div class="dashboard-sections">
            <div class="dashboard-section">
                <h3>ğŸ“Š è¨‚é–±ç®¡ç†çµ±è¨ˆ</h3>
                <div class="stats-grid">
                    <div class="stat-card stat-primary">
                        <div class="stat-number" id="sub-total">0</div>
                        <div class="stat-label">ç¸½è¨‚é–±æ•¸</div>
                    </div>
                    <div class="stat-card stat-danger">
                        <div class="stat-number" id="sub-3days">0</div>
                        <div class="stat-label">3å¤©å…§åˆ°æœŸ</div>
                    </div>
                    <div class="stat-card stat-warning">
                        <div class="stat-number" id="sub-7days">0</div>
                        <div class="stat-label">7å¤©å…§åˆ°æœŸ</div>
                    </div>
                    <div class="stat-card stat-error">
                        <div class="stat-number" id="sub-expired">0</div>
                        <div class="stat-label">å·²éæœŸ</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-section">
                <h3>ğŸ é£Ÿå“ç®¡ç†çµ±è¨ˆ</h3>
                <div class="stats-grid">
                    <div class="stat-card stat-primary">
                        <div class="stat-number" id="food-total">0</div>
                        <div class="stat-label">ç¸½é£Ÿå“æ•¸</div>
                    </div>
                    <div class="stat-card stat-warning">
                        <div class="stat-number" id="food-7days">0</div>
                        <div class="stat-label">7å¤©å…§åˆ°æœŸ</div>
                    </div>
                    <div class="stat-card stat-info">
                        <div class="stat-number" id="food-30days">0</div>
                        <div class="stat-label">30å¤©å…§åˆ°æœŸ</div>
                    </div>
                    <div class="stat-card stat-error">
                        <div class="stat-number" id="food-expired">0</div>
                        <div class="stat-label">å·²éæœŸ</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-alerts">
                <div class="alert-section">
                    <h3>âš ï¸ è¨‚é–±åˆ°æœŸæé†’</h3>
                    <div class="alert-list" id="subscription-alerts">
                        <div class="alert-item alert-info">
                            <span class="alert-icon">ğŸ“‹</span>
                            <span class="alert-text">å°šæœªè¼‰å…¥æ•¸æ“š</span>
                        </div>
                    </div>
                </div>

                <div class="alert-section">
                    <h3>ğŸ é£Ÿå“åˆ°æœŸæé†’</h3>
                    <div class="alert-list" id="food-alerts">
                        <div class="alert-item alert-info">
                            <span class="alert-icon">ğŸ“‹</span>
                            <span class="alert-text">å°šæœªè¼‰å…¥æ•¸æ“š</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="src/js/contentfulManager.js"></script>
    <script src="src/js/crudManager.js"></script>
    <script src="src/js/dashboardManager.js"></script>
    <script src="test-dashboard.js"></script>
    
    <script>
        // æ¼”ç¤ºç”¨çš„æ¸¬è©¦æ•¸æ“š
        const demoData = {
            subscriptions: [
                {
                    id: 'demo-sub1',
                    name: 'Netflix è¨‚é–±',
                    expiryDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(),
                    price: 390,
                    category: 'å¨›æ¨‚'
                },
                {
                    id: 'demo-sub2',
                    name: 'Spotify Premium',
                    expiryDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                    price: 149,
                    category: 'éŸ³æ¨‚'
                },
                {
                    id: 'demo-sub3',
                    name: 'Adobe Creative Cloud',
                    expiryDate: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    price: 1680,
                    category: 'å·¥å…·'
                },
                {
                    id: 'demo-sub4',
                    name: 'Microsoft 365',
                    expiryDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                    price: 2190,
                    category: 'è¾¦å…¬'
                }
            ],
            foodItems: [
                {
                    id: 'demo-food1',
                    name: 'ç‰›å¥¶',
                    expiryDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                    category: 'ä¹³è£½å“',
                    location: 'å†°ç®±'
                },
                {
                    id: 'demo-food2',
                    name: 'éºµåŒ…',
                    expiryDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                    category: 'ä¸»é£Ÿ',
                    location: 'å»šæˆ¿'
                },
                {
                    id: 'demo-food3',
                    name: 'å„ªæ ¼',
                    expiryDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    category: 'ä¹³è£½å“',
                    location: 'å†°ç®±'
                },
                {
                    id: 'demo-food4',
                    name: 'è˜‹æœ',
                    expiryDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                    category: 'æ°´æœ',
                    location: 'å†°ç®±'
                },
                {
                    id: 'demo-food5',
                    name: 'é›è›‹',
                    expiryDate: new Date(Date.now() + 20 * 24 * 60 * 60 * 1000).toISOString(),
                    category: 'è›‹é¡',
                    location: 'å†°ç®±'
                }
            ]
        };
        
        // ç‹€æ…‹æ›´æ–°å‡½æ•¸
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('demo-status');
            statusEl.innerHTML = `<strong>ç‹€æ…‹:</strong> ${message}`;
            statusEl.className = `demo-status status-${type}`;
        }
        
        // è¼‰å…¥æ¸¬è©¦æ•¸æ“š
        function loadTestData() {
            updateStatus('è¼‰å…¥æ¸¬è©¦æ•¸æ“šä¸­...', 'loading');
            
            try {
                // å‰µå»ºæ¨¡æ“¬çš„ CRUD ç®¡ç†å™¨
                if (!window.crudManager) {
                    window.crudManager = {
                        subscriptions: [],
                        foodItems: []
                    };
                }
                
                // è¼‰å…¥æ¸¬è©¦æ•¸æ“š
                window.crudManager.subscriptions = demoData.subscriptions;
                window.crudManager.foodItems = demoData.foodItems;
                
                updateStatus(`æ¸¬è©¦æ•¸æ“šè¼‰å…¥å®Œæˆï¼è¨‚é–±: ${demoData.subscriptions.length} å€‹ï¼Œé£Ÿå“: ${demoData.foodItems.length} å€‹`, 'success');
                
                // è‡ªå‹•åˆ·æ–°å„€è¡¨æ¿
                setTimeout(() => refreshDashboard(), 500);
                
            } catch (error) {
                console.error('è¼‰å…¥æ¸¬è©¦æ•¸æ“šå¤±æ•—:', error);
                updateStatus('è¼‰å…¥æ¸¬è©¦æ•¸æ“šå¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // åˆ·æ–°å„€è¡¨æ¿
        function refreshDashboard() {
            updateStatus('åˆ·æ–°å„€è¡¨æ¿æ•¸æ“šä¸­...', 'loading');
            
            try {
                // æ‰‹å‹•è¨ˆç®—çµ±è¨ˆæ•¸æ“š
                const now = new Date();
                const subscriptions = window.crudManager?.subscriptions || [];
                const foodItems = window.crudManager?.foodItems || [];
                
                // è¨‚é–±çµ±è¨ˆ
                const subStats = {
                    total: subscriptions.length,
                    expiring3Days: subscriptions.filter(sub => {
                        const expiryDate = new Date(sub.expiryDate);
                        const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                        return diffDays > 0 && diffDays <= 3;
                    }).length,
                    expiring7Days: subscriptions.filter(sub => {
                        const expiryDate = new Date(sub.expiryDate);
                        const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                        return diffDays > 0 && diffDays <= 7;
                    }).length,
                    expired: subscriptions.filter(sub => {
                        const expiryDate = new Date(sub.expiryDate);
                        return expiryDate < now;
                    }).length
                };
                
                // é£Ÿå“çµ±è¨ˆ
                const foodStats = {
                    total: foodItems.length,
                    expiring7Days: foodItems.filter(food => {
                        const expiryDate = new Date(food.expiryDate);
                        const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                        return diffDays > 0 && diffDays <= 7;
                    }).length,
                    expiring30Days: foodItems.filter(food => {
                        const expiryDate = new Date(food.expiryDate);
                        const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                        return diffDays > 0 && diffDays <= 30;
                    }).length,
                    expired: foodItems.filter(food => {
                        const expiryDate = new Date(food.expiryDate);
                        return expiryDate < now;
                    }).length
                };
                
                // æ›´æ–°UI
                document.getElementById('sub-total').textContent = subStats.total;
                document.getElementById('sub-3days').textContent = subStats.expiring3Days;
                document.getElementById('sub-7days').textContent = subStats.expiring7Days;
                document.getElementById('sub-expired').textContent = subStats.expired;
                
                document.getElementById('food-total').textContent = foodStats.total;
                document.getElementById('food-7days').textContent = foodStats.expiring7Days;
                document.getElementById('food-30days').textContent = foodStats.expiring30Days;
                document.getElementById('food-expired').textContent = foodStats.expired;
                
                // æ›´æ–°æé†’
                updateAlerts(subscriptions, foodItems, now);
                
                updateStatus('å„€è¡¨æ¿æ•¸æ“šåˆ·æ–°å®Œæˆï¼', 'success');
                
            } catch (error) {
                console.error('åˆ·æ–°å„€è¡¨æ¿å¤±æ•—:', error);
                updateStatus('åˆ·æ–°å„€è¡¨æ¿å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // æ›´æ–°æé†’
        function updateAlerts(subscriptions, foodItems, now) {
            // è¨‚é–±æé†’
            const subAlerts = subscriptions
                .filter(sub => {
                    const expiryDate = new Date(sub.expiryDate);
                    const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    return diffDays <= 7;
                })
                .map(sub => {
                    const expiryDate = new Date(sub.expiryDate);
                    const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    
                    let status = 'warning';
                    let message = '';
                    
                    if (diffDays < 0) {
                        status = 'danger';
                        message = `å·²éæœŸ ${Math.abs(diffDays)} å¤©`;
                    } else if (diffDays === 0) {
                        status = 'danger';
                        message = 'ä»Šå¤©åˆ°æœŸ';
                    } else if (diffDays <= 3) {
                        status = 'danger';
                        message = `${diffDays} å¤©å¾Œåˆ°æœŸ`;
                    } else {
                        status = 'warning';
                        message = `${diffDays} å¤©å¾Œåˆ°æœŸ`;
                    }
                    
                    return { ...sub, status, message };
                });
            
            // é£Ÿå“æé†’
            const foodAlerts = foodItems
                .filter(food => {
                    const expiryDate = new Date(food.expiryDate);
                    const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    return diffDays <= 30;
                })
                .map(food => {
                    const expiryDate = new Date(food.expiryDate);
                    const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    
                    let status = 'info';
                    let message = '';
                    
                    if (diffDays < 0) {
                        status = 'danger';
                        message = `å·²éæœŸ ${Math.abs(diffDays)} å¤©`;
                    } else if (diffDays === 0) {
                        status = 'danger';
                        message = 'ä»Šå¤©åˆ°æœŸ';
                    } else if (diffDays <= 7) {
                        status = 'warning';
                        message = `${diffDays} å¤©å¾Œåˆ°æœŸ`;
                    } else {
                        status = 'info';
                        message = `${diffDays} å¤©å¾Œåˆ°æœŸ`;
                    }
                    
                    return { ...food, status, message };
                });
            
            // æ›´æ–°è¨‚é–±æé†’UI
            const subAlertsEl = document.getElementById('subscription-alerts');
            if (subAlerts.length === 0) {
                subAlertsEl.innerHTML = `
                    <div class="alert-item alert-success">
                        <span class="alert-icon">âœ…</span>
                        <span class="alert-text">ç›®å‰æ²’æœ‰è¨‚é–±åˆ°æœŸæé†’</span>
                    </div>
                `;
            } else {
                subAlertsEl.innerHTML = subAlerts.map(alert => `
                    <div class="alert-item alert-${alert.status}">
                        <span class="alert-icon">${getAlertIcon(alert.status)}</span>
                        <div class="alert-content">
                            <div class="alert-title">${alert.name}</div>
                            <div class="alert-message">${alert.message}</div>
                            <div class="alert-date">åˆ°æœŸæ—¥: ${new Date(alert.expiryDate).toLocaleDateString('zh-TW')}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // æ›´æ–°é£Ÿå“æé†’UI
            const foodAlertsEl = document.getElementById('food-alerts');
            if (foodAlerts.length === 0) {
                foodAlertsEl.innerHTML = `
                    <div class="alert-item alert-success">
                        <span class="alert-icon">âœ…</span>
                        <span class="alert-text">ç›®å‰æ²’æœ‰é£Ÿå“åˆ°æœŸæé†’</span>
                    </div>
                `;
            } else {
                foodAlertsEl.innerHTML = foodAlerts.map(alert => `
                    <div class="alert-item alert-${alert.status}">
                        <span class="alert-icon">${getAlertIcon(alert.status)}</span>
                        <div class="alert-content">
                            <div class="alert-title">${alert.name}</div>
                            <div class="alert-message">${alert.message}</div>
                            <div class="alert-date">åˆ°æœŸæ—¥: ${new Date(alert.expiryDate).toLocaleDateString('zh-TW')}</div>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // ç²å–æé†’åœ–æ¨™
        function getAlertIcon(status) {
            switch (status) {
                case 'danger': return 'ğŸš¨';
                case 'warning': return 'âš ï¸';
                case 'info': return 'â„¹ï¸';
                default: return 'ğŸ“‹';
            }
        }
        
        // åŸ·è¡Œæ¸¬è©¦
        function runTests() {
            updateStatus('åŸ·è¡Œå„€è¡¨æ¿æ¸¬è©¦ä¸­...', 'loading');
            
            try {
                // ç¢ºä¿æœ‰æ¸¬è©¦æ•¸æ“š
                if (!window.crudManager || !window.crudManager.subscriptions.length) {
                    loadTestData();
                    setTimeout(() => runTests(), 1000);
                    return;
                }
                
                // åŸ·è¡Œæ¸¬è©¦
                const results = {
                    dataLoaded: !!(window.crudManager && window.crudManager.subscriptions.length > 0),
                    uiUpdated: document.getElementById('sub-total').textContent !== '0',
                    alertsGenerated: document.getElementById('subscription-alerts').children.length > 0
                };
                
                const success = Object.values(results).every(r => r);
                
                if (success) {
                    updateStatus('æ‰€æœ‰æ¸¬è©¦é€šéï¼å„€è¡¨æ¿åŠŸèƒ½æ­£å¸¸é‹ä½œ', 'success');
                } else {
                    updateStatus('éƒ¨åˆ†æ¸¬è©¦å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ§åˆ¶å°', 'error');
                }
                
                console.log('ğŸ§ª æ¸¬è©¦çµæœ:', results);
                
            } catch (error) {
                console.error('åŸ·è¡Œæ¸¬è©¦å¤±æ•—:', error);
                updateStatus('åŸ·è¡Œæ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // å°å‡ºå ±å‘Š
        function exportReport() {
            updateStatus('ç”Ÿæˆå ±å‘Šä¸­...', 'loading');
            
            try {
                const report = {
                    timestamp: new Date().toISOString(),
                    data: {
                        subscriptions: window.crudManager?.subscriptions || [],
                        foodItems: window.crudManager?.foodItems || []
                    },
                    stats: {
                        subscriptionTotal: document.getElementById('sub-total').textContent,
                        foodTotal: document.getElementById('food-total').textContent
                    }
                };
                
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `dashboard-demo-report-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
                
                updateStatus('å ±å‘Šå·²å°å‡ºï¼', 'success');
                
            } catch (error) {
                console.error('å°å‡ºå ±å‘Šå¤±æ•—:', error);
                updateStatus('å°å‡ºå ±å‘Šå¤±æ•—: ' + error.message, 'error');
            }
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('æ¼”ç¤ºé é¢è¼‰å…¥å®Œæˆï¼Œè«‹é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¼”ç¤º', 'success');
            
            // æä¾›æ§åˆ¶å°å‘½ä»¤æç¤º
            console.log('ğŸ¯ å„€è¡¨æ¿æ¼”ç¤ºé é¢å·²è¼‰å…¥');
            console.log('ğŸ’¡ å¯ç”¨å‘½ä»¤:');
            console.log('   loadTestData()    // è¼‰å…¥æ¸¬è©¦æ•¸æ“š');
            console.log('   refreshDashboard() // åˆ·æ–°å„€è¡¨æ¿');
            console.log('   runTests()        // åŸ·è¡Œæ¸¬è©¦');
            console.log('   exportReport()    // å°å‡ºå ±å‘Š');
        });
    </script>
</body>
</html>