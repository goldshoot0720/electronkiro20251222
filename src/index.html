<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鋒兄AI資訊系統</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/dashboard.css">
</head>
<body>
    <div class="app-container">
        <!-- 側邊欄 -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">鋒</span>
                    <span class="logo-text">鋒兄AI系統</span>
                </div>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <span class="menu-icon">🏠</span>
                    <span class="menu-text">首頁</span>
                </div>
                <div class="menu-item" data-page="templates">
                    <span class="menu-icon">📋</span>
                    <span class="menu-text">儀表板</span>
                </div>
                <div class="menu-item" data-page="images">
                    <span class="menu-icon">🖼️</span>
                    <span class="menu-text">圖片庫</span>
                </div>
                <div class="menu-item" data-page="videos">
                    <span class="menu-icon">🎬</span>
                    <span class="menu-text">影片庫</span>
                </div>
                <div class="menu-item" data-page="subscriptions">
                    <span class="menu-icon">📊</span>
                    <span class="menu-text">訂閱管理</span>
                </div>
                <div class="menu-item" data-page="food">
                    <span class="menu-icon">🍎</span>
                    <span class="menu-text">食品管理</span>
                </div>
                <div class="menu-item" data-page="music">
                    <span class="menu-icon">🎵</span>
                    <span class="menu-text">鋒兄音樂</span>
                </div>
            </div>
        </nav>

        <!-- 主要內容區域 -->
        <main class="main-content">
            <div class="content-header">
                <h1 id="page-title">歡迎使用鋒兄AI資訊系統</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" id="main-action-btn">重新整理</button>
                </div>
            </div>

            <div class="content-body">
                <!-- 儀表板頁面 -->
                <div id="dashboard-page" class="page active">
                    <div class="welcome-section">
                        <div class="welcome-card">
                            <div class="welcome-icon">鋒</div>
                            <h2>鋒兄AI資訊系統</h2>
                            <p>智能管理您的影片和圖片收藏，支援智能分類和快速搜尋</p>
                            <div class="system-info">
                                <p>鋒兄達哥公開資訊 © 版權所有 2025 - 2125</p>
                            </div>
                        </div>
                    </div>

                    <div class="features-section">
                        <div class="feature-group">
                            <h3>🔧 前端技術</h3>
                            <ul>
                                <li>Electron 桌面應用程式</li>
                                <li>HTML5 + CSS3 + JavaScript</li>
                                <li>響應式設計 + 現代化 UI</li>
                            </ul>
                        </div>
                        <div class="feature-group">
                            <h3>💎 後端技術</h3>
                            <ul>
                                <li>Contentful CMS</li>
                                <li>雲端內容管理平台</li>
                                <li>RESTful API 支援</li>
                            </ul>
                        </div>
                        <div class="feature-group">
                            <h3>🎵 鋒兄音樂推薦</h3>
                            <ul>
                                <li>🔥 鋒兄進化Show (最新熱門)</li>
                                <li>💕 史上最瞎結婚理由</li>
                                <li>🎤 更多原創作品陸續推出...</li>
                            </ul>
                        </div>
                    </div>

                    <div class="stats-section">
                        <h3>📊 系統功能選單</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">244</div>
                                <div class="stat-label">總計圖檔</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">2</div>
                                <div class="stat-label">鋒兄歌曲</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">2</div>
                                <div class="stat-label">活躍訂閱</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">2</div>
                                <div class="stat-label">影片檔案</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 圖片庫頁面 -->
                <div id="images-page" class="page">
                    <div class="page-header">
                        <h2>鋒兄圖片庫</h2>
                        <p>找兄帥哥圖片和收藏AI創作 (241 張圖片)</p>
                        <button class="btn btn-primary">新增圖片</button>
                    </div>
                    
                    <div class="filters-section">
                        <input type="text" placeholder="搜尋圖片名稱或標籤..." class="search-input">
                        <select class="filter-select">
                            <option>所有類型</option>
                            <option>JPG</option>
                            <option>PNG</option>
                            <option>GIF</option>
                        </select>
                        <select class="filter-select">
                            <option>按名稱排序</option>
                            <option>按日期排序</option>
                            <option>按大小排序</option>
                        </select>
                    </div>

                    <div class="images-grid" id="images-grid">
                        <!-- 圖片將通過 JavaScript 動態載入 -->
                    </div>
                </div>

                <!-- 影片庫頁面 -->
                <div id="videos-page" class="page">
                    <div class="page-header">
                        <h2>鋒兄影片庫</h2>
                        <p>找兄帥哥影片人生與現實歷程</p>
                        <button class="btn btn-primary">新增影片</button>
                    </div>
                    
                    <div class="search-section">
                        <input type="text" placeholder="搜尋影片名稱..." class="search-input">
                        <button class="btn btn-secondary">搜尋</button>
                    </div>

                    <div class="videos-grid" id="videos-grid">
                        <!-- 影片將通過 JavaScript 動態載入 -->
                    </div>
                </div>

                <!-- 食品管理頁面 -->
                <div id="food-page" class="page">
                    <div class="page-header">
                        <h2>食品管理系統</h2>
                        <p>管理您的食品存放和到期日提醒</p>
                        <button class="btn btn-primary" onclick="app.showFoodForm()">新增食品</button>
                    </div>
                    
                    <div class="search-section">
                        <input type="text" placeholder="搜尋食品名稱或商品..." class="search-input" id="food-search" onkeyup="app.searchFood(this.value)">
                        <button class="btn btn-secondary" onclick="app.loadFood()">重新載入</button>
                        <button class="btn btn-info" onclick="app.showFoodStats()">統計資訊</button>
                    </div>

                    <div class="food-grid" id="food-grid">
                        <!-- 食品項目將通過 JavaScript 動態載入 -->
                    </div>
                </div>

                <!-- 訂閱管理頁面 -->
                <div id="subscriptions-page" class="page">
                    <div class="page-header">
                        <h2>訂閱管理系統</h2>
                        <p>管理您的各種訂閱服務和到期資訊</p>
                        <button class="btn btn-primary" onclick="app.showSubscriptionForm()">新增訂閱</button>
                    </div>
                    
                    <div class="search-section">
                        <input type="text" placeholder="搜尋訂閱名稱..." class="search-input" id="subscription-search" onkeyup="app.searchSubscriptions(this.value)">
                        <button class="btn btn-secondary" onclick="app.loadSubscriptions()">重新載入</button>
                        <button class="btn btn-info" onclick="app.showSubscriptionStats()">統計資訊</button>
                    </div>

                    <div class="subscriptions-list" id="subscriptions-list">
                        <!-- 訂閱項目將通過 JavaScript 動態載入 -->
                    </div>
                </div>

                <!-- 系統儀表板頁面 -->
                <div id="templates-page" class="page">
                    <div class="page-header">
                        <h2>系統儀表板</h2>
                        <p>即時監控系統各項指標和資料統計</p>
                        <div class="header-actions">
                            <button class="btn btn-primary" onclick="dashboardManager.refreshDashboard()">🔄 刷新數據</button>
                            <button class="btn btn-secondary" onclick="dashboardManager.exportData()">📊 導出報告</button>
                        </div>
                    </div>

                    <div class="dashboard-sections">
                        <div class="dashboard-section">
                            <h3>📊 訂閱管理</h3>
                            <div class="stats-grid">
                                <div class="stat-card stat-primary">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">總訂閱數</div>
                                </div>
                                <div class="stat-card stat-danger">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">3天內到期</div>
                                </div>
                                <div class="stat-card stat-warning">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">7天內到期</div>
                                </div>
                                <div class="stat-card stat-error">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">已過期</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-section">
                            <h3>🍎 食品管理</h3>
                            <div class="stats-grid">
                                <div class="stat-card stat-primary">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">總食品數</div>
                                </div>
                                <div class="stat-card stat-warning">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">7天內到期</div>
                                </div>
                                <div class="stat-card stat-info">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">30天內到期</div>
                                </div>
                                <div class="stat-card stat-error">
                                    <div class="stat-number">0</div>
                                    <div class="stat-label">已過期</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-alerts">
                            <div class="alert-section">
                                <h3>⚠️ 訂閱到期提醒</h3>
                                <div class="alert-list" id="subscription-alerts">
                                    <div class="alert-item alert-info">
                                        <span class="alert-icon">⏳</span>
                                        <span class="alert-text">載入中...</span>
                                    </div>
                                </div>
                            </div>

                            <div class="alert-section">
                                <h3>🍎 食品到期提醒</h3>
                                <div class="alert-list" id="food-alerts">
                                    <div class="alert-item alert-info">
                                        <span class="alert-icon">⏳</span>
                                        <span class="alert-text">載入中...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 鋒兄音樂頁面 -->
                <div id="music-page" class="page">
                    <div class="page-header">
                        <h2>🎵 鋒兄音樂庫</h2>
                        <p>鋒兄原創歌曲和搞笑作品集</p>
                        <button class="btn btn-primary">新增歌曲</button>
                    </div>
                    
                    <div class="search-section">
                        <input type="text" placeholder="搜尋歌曲名稱、歌詞或標籤..." class="search-input" id="music-search" onkeyup="app.searchMusic(this.value)">
                        <select id="music-language" onchange="app.searchMusic(document.getElementById('music-search').value)">
                            <option value="zh">中文</option>
                            <option value="en">English</option>
                            <option value="ja">日本語</option>
                        </select>
                        <button class="btn btn-secondary" onclick="app.loadMusic()">重新載入</button>
                    </div>

                    <div class="music-content" id="music-content">
                        <!-- 音樂內容將通過 JavaScript 動態載入 -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/contentfulManager.js"></script>
    <script src="js/crudManager.js"></script>
    <script src="js/imageManager.js"></script>
    <script src="js/videoManager.js"></script>
    <script src="js/songManager.js"></script>
    <script src="js/dashboardManager.js"></script>
    <script src="js/app.js"></script>
    <script src="js/components.js"></script>
    
    <script>
        // 初始化應用程式
        let app;
        
        // 等待 DOM 載入完成後初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 開始初始化鋒兄AI資訊系統...');
            
            try {
                // 創建 App 實例
                app = new App();
                
                // 設定為全域變數以供 HTML 事件使用
                window.app = app;
                
                console.log('✅ 應用程式初始化完成');
                
                // 初始化儀表板
                setTimeout(() => {
                    if (window.dashboardManager) {
                        console.log('🎯 初始化儀表板管理器...');
                        window.dashboardManager.refreshDashboard();
                    }
                }, 1000);
                
                // 顯示初始化狀態
                setTimeout(() => {
                    if (app.crudManagerInitialized) {
                        console.log('✅ CRUD 管理器已完全初始化');
                        
                        // 刷新儀表板數據
                        if (window.dashboardManager) {
                            window.dashboardManager.refreshDashboard();
                        }
                    } else {
                        console.log('⚠️ CRUD 管理器仍在初始化中...');
                        
                        // 如果 5 秒後仍未初始化，提供手動修正選項
                        setTimeout(() => {
                            if (!app.crudManagerInitialized) {
                                console.log('❌ CRUD 管理器初始化超時');
                                console.log('💡 請在控制台執行以下命令進行手動修正:');
                                console.log('   app.initCrudManager()');
                                
                                // 顯示用戶提示
                                if (typeof app.showNotification === 'function') {
                                    app.showNotification('系統初始化中，請稍後再試', 'warning');
                                }
                            }
                        }, 5000);
                    }
                }, 2000);
                
            } catch (error) {
                console.error('❌ 應用程式初始化失敗:', error);
                
                // 顯示錯誤提示
                document.body.innerHTML += `
                    <div style="position: fixed; top: 20px; right: 20px; background: #f44336; color: white; padding: 15px; border-radius: 5px; z-index: 9999;">
                        <strong>初始化失敗</strong><br>
                        請重新載入頁面或檢查控制台錯誤
                    </div>
                `;
            }
        });
        
        // 提供緊急修正函數
        window.emergencyFixCRUD = async function() {
            console.log('🚨 執行緊急 CRUD 修正...');
            
            if (!app) {
                console.error('❌ App 實例不存在');
                return false;
            }
            
            try {
                // 強制重新初始化
                app.crudManagerInitialized = false;
                await app.initCrudManager();
                
                console.log('✅ 緊急修正完成');
                
                if (typeof app.showNotification === 'function') {
                    app.showNotification('CRUD 功能已修復', 'success');
                }
                
                return true;
            } catch (error) {
                console.error('❌ 緊急修正失敗:', error);
                return false;
            }
        };
        
        // 檢查狀態函數
        window.checkCRUDStatus = function() {
            if (!app) {
                console.log('❌ App 實例不存在');
                return;
            }
            
            console.log('📊 CRUD 狀態檢查:');
            console.log('   App 實例:', '✅ 存在');
            console.log('   CRUD 管理器:', app.crudManager ? '✅ 存在' : '❌ 不存在');
            console.log('   初始化狀態:', app.crudManagerInitialized ? '✅ 完成' : '❌ 未完成');
            
            if (app.crudManager) {
                console.log('   食品數量:', app.crudManager.foodItems?.length || 0);
                console.log('   訂閱數量:', app.crudManager.subscriptions?.length || 0);
            }
        };
        
        console.log('💡 可用的修正命令:');
        console.log('   checkCRUDStatus()     // 檢查 CRUD 狀態');
        console.log('   emergencyFixCRUD()    // 緊急修正 CRUD');
        console.log('   app.initCrudManager() // 重新初始化 CRUD');
    </script>
</body>
</html>