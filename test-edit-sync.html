<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·¨è¼¯åŠŸèƒ½åŒæ­¥æ¸¬è©¦</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .status-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #007bff;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: #fff;
        }
        
        .test-section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .log-area {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            border: 2px solid #333;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .data-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #dee2e6;
        }
        
        .data-card h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .data-card p {
            margin: 5px 0;
            color: #6c757d;
            font-size: 14px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #28a745;
        }
        
        .status-offline {
            background: #dc3545;
        }
        
        .status-syncing {
            background: #ffc107;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 8px;
        }
        
        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }
        
        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ç·¨è¼¯åŠŸèƒ½åŒæ­¥æ¸¬è©¦</h1>
            <p>æ¸¬è©¦é£Ÿå“å’Œè¨‚é–±ç·¨è¼¯åŠŸèƒ½æ˜¯å¦æ­£ç¢ºåŒæ­¥åˆ° Contentful</p>
        </div>

        <div class="status-panel">
            <h3>ğŸ” ç³»çµ±ç‹€æ…‹</h3>
            <p id="connection-status">
                <span class="status-indicator status-offline"></span>
                æ­£åœ¨æª¢æŸ¥é€£æ¥ç‹€æ…‹...
            </p>
            <p id="data-status">æ­£åœ¨è¼‰å…¥æ•¸æ“š...</p>
        </div>

        <div class="test-section">
            <h3>ğŸš€ å¿«é€Ÿä¿®å¾©</h3>
            <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•ç«‹å³ä¿®å¾©ç·¨è¼¯åŠŸèƒ½åŒæ­¥å•é¡Œï¼š</p>
            <button class="btn btn-primary" onclick="applyFix()">ğŸ”§ ç«‹å³ä¿®å¾©ç·¨è¼¯åŒæ­¥å•é¡Œ</button>
            <button class="btn btn-success" onclick="testEditSync()">ğŸ§ª æ¸¬è©¦ç·¨è¼¯åŒæ­¥åŠŸèƒ½</button>
            <button class="btn btn-warning" onclick="loadTestData()">ğŸ“Š è¼‰å…¥æ¸¬è©¦æ•¸æ“š</button>
        </div>

        <div class="test-section">
            <h3>ğŸ é£Ÿå“ç·¨è¼¯æ¸¬è©¦</h3>
            <div id="food-data" class="data-grid">
                <p>æ­£åœ¨è¼‰å…¥é£Ÿå“æ•¸æ“š...</p>
            </div>
            <button class="btn btn-primary" onclick="testFoodEdit()">æ¸¬è©¦é£Ÿå“ç·¨è¼¯</button>
        </div>

        <div class="test-section">
            <h3>ğŸ’³ è¨‚é–±ç·¨è¼¯æ¸¬è©¦</h3>
            <div id="subscription-data" class="data-grid">
                <p>æ­£åœ¨è¼‰å…¥è¨‚é–±æ•¸æ“š...</p>
            </div>
            <button class="btn btn-primary" onclick="testSubscriptionEdit()">æ¸¬è©¦è¨‚é–±ç·¨è¼¯</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ æ¸¬è©¦æ—¥èªŒ</h3>
            <div id="log-area" class="log-area">
                <div>ğŸ”§ ç·¨è¼¯åŠŸèƒ½åŒæ­¥æ¸¬è©¦å·¥å…·å·²å•Ÿå‹•</div>
                <div>ğŸ“… æ™‚é–“: <span id="current-time"></span></div>
                <div>ğŸ” æ­£åœ¨æª¢æŸ¥ç³»çµ±ç‹€æ…‹...</div>
            </div>
            <button class="btn btn-warning" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
            <button class="btn btn-success" onclick="exportLog()">å°å‡ºæ—¥èªŒ</button>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="src/js/contentfulManager.js"></script>
    <script src="src/js/crudManager.js"></script>
    <script src="fix-edit-sync.js"></script>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let contentfulManager = null;
        let crudManager = null;
        let testLog = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            initializeManagers();
        });

        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleString('zh-TW');
        }

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('zh-TW');
            const logEntry = `[${timestamp}] ${message}`;
            testLog.push(logEntry);
            
            const logArea = document.getElementById('log-area');
            const logDiv = document.createElement('div');
            logDiv.textContent = logEntry;
            
            if (type === 'error') {
                logDiv.style.color = '#ff6b6b';
            } else if (type === 'success') {
                logDiv.style.color = '#51cf66';
            } else if (type === 'warning') {
                logDiv.style.color = '#ffd43b';
            }
            
            logArea.appendChild(logDiv);
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(logEntry);
        }

        async function initializeManagers() {
            try {
                log('ğŸ”„ æ­£åœ¨åˆå§‹åŒ–ç®¡ç†å™¨...');
                
                // åˆå§‹åŒ– Contentful ç®¡ç†å™¨
                if (typeof ContentfulManager !== 'undefined') {
                    contentfulManager = new ContentfulManager();
                    log('âœ… ContentfulManager åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    log('âŒ ContentfulManager æœªæ‰¾åˆ°', 'error');
                }
                
                // åˆå§‹åŒ– CRUD ç®¡ç†å™¨
                if (typeof CrudManager !== 'undefined') {
                    crudManager = new CrudManager(contentfulManager);
                    log('âœ… CrudManager åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    log('âŒ CrudManager æœªæ‰¾åˆ°', 'error');
                }
                
                // æ¸¬è©¦é€£æ¥
                await testConnection();
                
                // è¼‰å…¥æ•¸æ“š
                await loadData();
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
            }
        }

        async function testConnection() {
            try {
                log('ğŸ” æ¸¬è©¦ Contentful é€£æ¥...');
                
                if (!contentfulManager) {
                    throw new Error('ContentfulManager æœªåˆå§‹åŒ–');
                }
                
                const result = await contentfulManager.testConnection();
                const statusEl = document.getElementById('connection-status');
                
                if (result.success) {
                    log(`âœ… Contentful é€£æ¥æˆåŠŸ: ${result.spaceName}`, 'success');
                    statusEl.innerHTML = `
                        <span class="status-indicator status-online"></span>
                        å·²é€£æ¥åˆ° Contentful: ${result.spaceName}
                    `;
                } else {
                    log(`âš ï¸ Contentful é€£æ¥å¤±æ•—: ${result.message}`, 'warning');
                    statusEl.innerHTML = `
                        <span class="status-indicator status-offline"></span>
                        Contentful é€£æ¥å¤±æ•—: ${result.message}
                    `;
                }
            } catch (error) {
                log(`âŒ é€£æ¥æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                document.getElementById('connection-status').innerHTML = `
                    <span class="status-indicator status-offline"></span>
                    é€£æ¥æ¸¬è©¦å¤±æ•—: ${error.message}
                `;
            }
        }

        async function loadData() {
            try {
                log('ğŸ“Š è¼‰å…¥æ•¸æ“š...');
                
                if (!crudManager) {
                    throw new Error('CrudManager æœªåˆå§‹åŒ–');
                }
                
                // è¼‰å…¥æ•¸æ“š
                await crudManager.loadInitialData();
                
                // æ›´æ–°UI
                updateFoodData();
                updateSubscriptionData();
                updateDataStatus();
                
                log('âœ… æ•¸æ“šè¼‰å…¥å®Œæˆ', 'success');
                
            } catch (error) {
                log(`âŒ è¼‰å…¥æ•¸æ“šå¤±æ•—: ${error.message}`, 'error');
            }
        }

        function updateFoodData() {
            const foods = crudManager ? crudManager.readAllFood() : [];
            const foodDataEl = document.getElementById('food-data');
            
            if (foods.length === 0) {
                foodDataEl.innerHTML = '<p>æ²’æœ‰é£Ÿå“æ•¸æ“š</p>';
                return;
            }
            
            foodDataEl.innerHTML = foods.map(food => `
                <div class="data-card">
                    <h4>${food.name}</h4>
                    <p><strong>ID:</strong> ${food.id}</p>
                    <p><strong>å“ç‰Œ:</strong> ${food.brand}</p>
                    <p><strong>åˆ°æœŸæ—¥:</strong> ${food.expiry}</p>
                    <p><strong>ç‹€æ…‹:</strong> ${food.status}</p>
                    <p><strong>Contentful ID:</strong> ${food.contentfulId || 'æœªè¨­å®š'}</p>
                    <button class="btn btn-warning" onclick="editFood(${food.id})">ç·¨è¼¯</button>
                </div>
            `).join('');
        }

        function updateSubscriptionData() {
            const subscriptions = crudManager ? crudManager.readAllSubscriptions() : [];
            const subDataEl = document.getElementById('subscription-data');
            
            if (subscriptions.length === 0) {
                subDataEl.innerHTML = '<p>æ²’æœ‰è¨‚é–±æ•¸æ“š</p>';
                return;
            }
            
            subDataEl.innerHTML = subscriptions.map(sub => `
                <div class="data-card">
                    <h4>${sub.name}</h4>
                    <p><strong>ID:</strong> ${sub.id}</p>
                    <p><strong>åƒ¹æ ¼:</strong> ${sub.price}</p>
                    <p><strong>ä¸‹æ¬¡ä»˜æ¬¾:</strong> ${sub.nextPayment}</p>
                    <p><strong>ç‹€æ…‹:</strong> ${sub.status}</p>
                    <p><strong>Contentful ID:</strong> ${sub.contentfulId || 'æœªè¨­å®š'}</p>
                    <button class="btn btn-warning" onclick="editSubscription(${sub.id})">ç·¨è¼¯</button>
                </div>
            `).join('');
        }

        function updateDataStatus() {
            const foods = crudManager ? crudManager.readAllFood() : [];
            const subscriptions = crudManager ? crudManager.readAllSubscriptions() : [];
            
            document.getElementById('data-status').textContent = 
                `å·²è¼‰å…¥ ${foods.length} å€‹é£Ÿå“é …ç›®å’Œ ${subscriptions.length} å€‹è¨‚é–±é …ç›®`;
        }

        async function applyFix() {
            try {
                log('ğŸ”§ æ­£åœ¨æ‡‰ç”¨ç·¨è¼¯åŒæ­¥ä¿®å¾©...', 'warning');
                
                // é€™è£¡æœƒåŸ·è¡Œ fix-edit-sync.js ä¸­çš„ä¿®å¾©é‚è¼¯
                // ç”±æ–¼è…³æœ¬å·²ç¶“è¼‰å…¥ï¼Œä¿®å¾©æ‡‰è©²å·²ç¶“è‡ªå‹•æ‡‰ç”¨
                
                log('âœ… ç·¨è¼¯åŒæ­¥ä¿®å¾©å·²æ‡‰ç”¨', 'success');
                alert('âœ… ç·¨è¼¯åŠŸèƒ½åŒæ­¥ä¿®å¾©å·²å®Œæˆï¼\n\nç¾åœ¨ç·¨è¼¯é£Ÿå“å’Œè¨‚é–±æ™‚æœƒè‡ªå‹•åŒæ­¥åˆ° Contentfulã€‚');
                
            } catch (error) {
                log(`âŒ æ‡‰ç”¨ä¿®å¾©å¤±æ•—: ${error.message}`, 'error');
                alert('âŒ ä¿®å¾©å¤±æ•—: ' + error.message);
            }
        }

        async function testEditSync() {
            try {
                log('ğŸ§ª é–‹å§‹æ¸¬è©¦ç·¨è¼¯åŒæ­¥åŠŸèƒ½...', 'warning');
                
                const foods = crudManager ? crudManager.readAllFood() : [];
                const subscriptions = crudManager ? crudManager.readAllSubscriptions() : [];
                
                let testsPassed = 0;
                let totalTests = 0;
                
                // æ¸¬è©¦é£Ÿå“ç·¨è¼¯
                if (foods.length > 0) {
                    totalTests++;
                    const testFood = foods[0];
                    log(`ğŸ æ¸¬è©¦ç·¨è¼¯é£Ÿå“: ${testFood.name}`);
                    
                    const result = await crudManager.updateFood(testFood.id, {
                        name: testFood.name + ' (æ¸¬è©¦ç·¨è¼¯)',
                        status: 'æ¸¬è©¦ä¸­'
                    });
                    
                    if (result.success) {
                        log('âœ… é£Ÿå“ç·¨è¼¯æ¸¬è©¦é€šé', 'success');
                        testsPassed++;
                    } else {
                        log(`âŒ é£Ÿå“ç·¨è¼¯æ¸¬è©¦å¤±æ•—: ${result.message}`, 'error');
                    }
                }
                
                // æ¸¬è©¦è¨‚é–±ç·¨è¼¯
                if (subscriptions.length > 0) {
                    totalTests++;
                    const testSub = subscriptions[0];
                    log(`ğŸ’³ æ¸¬è©¦ç·¨è¼¯è¨‚é–±: ${testSub.name}`);
                    
                    const result = await crudManager.updateSubscription(testSub.id, {
                        name: testSub.name + ' (æ¸¬è©¦ç·¨è¼¯)',
                        price: 'NT$ 999'
                    });
                    
                    if (result.success) {
                        log('âœ… è¨‚é–±ç·¨è¼¯æ¸¬è©¦é€šé', 'success');
                        testsPassed++;
                    } else {
                        log(`âŒ è¨‚é–±ç·¨è¼¯æ¸¬è©¦å¤±æ•—: ${result.message}`, 'error');
                    }
                }
                
                // æ›´æ–°UI
                updateFoodData();
                updateSubscriptionData();
                
                // é¡¯ç¤ºæ¸¬è©¦çµæœ
                const message = `æ¸¬è©¦å®Œæˆï¼\né€šé: ${testsPassed}/${totalTests}`;
                log(message, testsPassed === totalTests ? 'success' : 'warning');
                alert(message);
                
            } catch (error) {
                log(`âŒ æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                alert('âŒ æ¸¬è©¦å¤±æ•—: ' + error.message);
            }
        }

        async function loadTestData() {
            try {
                log('ğŸ“Š è¼‰å…¥æ¸¬è©¦æ•¸æ“š...', 'warning');
                
                if (!crudManager) {
                    throw new Error('CrudManager æœªåˆå§‹åŒ–');
                }
                
                // é‡æ–°è¼‰å…¥æ•¸æ“š
                await crudManager.loadInitialData();
                
                // æ›´æ–°UI
                updateFoodData();
                updateSubscriptionData();
                updateDataStatus();
                
                log('âœ… æ¸¬è©¦æ•¸æ“šè¼‰å…¥å®Œæˆ', 'success');
                
            } catch (error) {
                log(`âŒ è¼‰å…¥æ¸¬è©¦æ•¸æ“šå¤±æ•—: ${error.message}`, 'error');
            }
        }

        async function testFoodEdit() {
            const foods = crudManager ? crudManager.readAllFood() : [];
            if (foods.length === 0) {
                alert('æ²’æœ‰é£Ÿå“æ•¸æ“šå¯ä¾›æ¸¬è©¦');
                return;
            }
            
            const testFood = foods[0];
            const newName = prompt('è¼¸å…¥æ–°çš„é£Ÿå“åç¨±:', testFood.name);
            if (!newName) return;
            
            try {
                log(`ğŸ ç·¨è¼¯é£Ÿå“: ${testFood.name} -> ${newName}`);
                const result = await crudManager.updateFood(testFood.id, {
                    name: newName,
                    status: 'å·²ç·¨è¼¯'
                });
                
                if (result.success) {
                    log('âœ… é£Ÿå“ç·¨è¼¯æˆåŠŸ', 'success');
                    updateFoodData();
                    alert('âœ… é£Ÿå“ç·¨è¼¯æˆåŠŸï¼');
                } else {
                    log(`âŒ é£Ÿå“ç·¨è¼¯å¤±æ•—: ${result.message}`, 'error');
                    alert('âŒ é£Ÿå“ç·¨è¼¯å¤±æ•—: ' + result.message);
                }
            } catch (error) {
                log(`âŒ é£Ÿå“ç·¨è¼¯éŒ¯èª¤: ${error.message}`, 'error');
                alert('âŒ é£Ÿå“ç·¨è¼¯éŒ¯èª¤: ' + error.message);
            }
        }

        async function testSubscriptionEdit() {
            const subscriptions = crudManager ? crudManager.readAllSubscriptions() : [];
            if (subscriptions.length === 0) {
                alert('æ²’æœ‰è¨‚é–±æ•¸æ“šå¯ä¾›æ¸¬è©¦');
                return;
            }
            
            const testSub = subscriptions[0];
            const newName = prompt('è¼¸å…¥æ–°çš„è¨‚é–±åç¨±:', testSub.name);
            if (!newName) return;
            
            try {
                log(`ğŸ’³ ç·¨è¼¯è¨‚é–±: ${testSub.name} -> ${newName}`);
                const result = await crudManager.updateSubscription(testSub.id, {
                    name: newName,
                    price: 'NT$ 888'
                });
                
                if (result.success) {
                    log('âœ… è¨‚é–±ç·¨è¼¯æˆåŠŸ', 'success');
                    updateSubscriptionData();
                    alert('âœ… è¨‚é–±ç·¨è¼¯æˆåŠŸï¼');
                } else {
                    log(`âŒ è¨‚é–±ç·¨è¼¯å¤±æ•—: ${result.message}`, 'error');
                    alert('âŒ è¨‚é–±ç·¨è¼¯å¤±æ•—: ' + result.message);
                }
            } catch (error) {
                log(`âŒ è¨‚é–±ç·¨è¼¯éŒ¯èª¤: ${error.message}`, 'error');
                alert('âŒ è¨‚é–±ç·¨è¼¯éŒ¯èª¤: ' + error.message);
            }
        }

        async function editFood(id) {
            const food = crudManager.readFood(id);
            if (!food) {
                alert('æ‰¾ä¸åˆ°æŒ‡å®šçš„é£Ÿå“');
                return;
            }
            
            const newName = prompt('è¼¸å…¥æ–°çš„é£Ÿå“åç¨±:', food.name);
            if (!newName) return;
            
            const newExpiry = prompt('è¼¸å…¥æ–°çš„åˆ°æœŸæ—¥ (YYYY-MM-DD):', food.expiry);
            if (!newExpiry) return;
            
            try {
                log(`ğŸ ç·¨è¼¯é£Ÿå“ ID ${id}: ${food.name} -> ${newName}`);
                const result = await crudManager.updateFood(id, {
                    name: newName,
                    expiry: newExpiry,
                    status: 'å·²ç·¨è¼¯'
                });
                
                if (result.success) {
                    log('âœ… é£Ÿå“ç·¨è¼¯æˆåŠŸ', 'success');
                    updateFoodData();
                    alert('âœ… é£Ÿå“ç·¨è¼¯æˆåŠŸï¼');
                } else {
                    log(`âŒ é£Ÿå“ç·¨è¼¯å¤±æ•—: ${result.message}`, 'error');
                    alert('âŒ é£Ÿå“ç·¨è¼¯å¤±æ•—: ' + result.message);
                }
            } catch (error) {
                log(`âŒ é£Ÿå“ç·¨è¼¯éŒ¯èª¤: ${error.message}`, 'error');
                alert('âŒ é£Ÿå“ç·¨è¼¯éŒ¯èª¤: ' + error.message);
            }
        }

        async function editSubscription(id) {
            const subscription = crudManager.readSubscription(id);
            if (!subscription) {
                alert('æ‰¾ä¸åˆ°æŒ‡å®šçš„è¨‚é–±');
                return;
            }
            
            const newName = prompt('è¼¸å…¥æ–°çš„è¨‚é–±åç¨±:', subscription.name);
            if (!newName) return;
            
            const newPrice = prompt('è¼¸å…¥æ–°çš„åƒ¹æ ¼:', subscription.price);
            if (!newPrice) return;
            
            try {
                log(`ğŸ’³ ç·¨è¼¯è¨‚é–± ID ${id}: ${subscription.name} -> ${newName}`);
                const result = await crudManager.updateSubscription(id, {
                    name: newName,
                    price: newPrice
                });
                
                if (result.success) {
                    log('âœ… è¨‚é–±ç·¨è¼¯æˆåŠŸ', 'success');
                    updateSubscriptionData();
                    alert('âœ… è¨‚é–±ç·¨è¼¯æˆåŠŸï¼');
                } else {
                    log(`âŒ è¨‚é–±ç·¨è¼¯å¤±æ•—: ${result.message}`, 'error');
                    alert('âŒ è¨‚é–±ç·¨è¼¯å¤±æ•—: ' + result.message);
                }
            } catch (error) {
                log(`âŒ è¨‚é–±ç·¨è¼¯éŒ¯èª¤: ${error.message}`, 'error');
                alert('âŒ è¨‚é–±ç·¨è¼¯éŒ¯èª¤: ' + error.message);
            }
        }

        function clearLog() {
            document.getElementById('log-area').innerHTML = '';
            testLog = [];
            log('ğŸ“‹ æ—¥èªŒå·²æ¸…é™¤');
        }

        function exportLog() {
            const logContent = testLog.join('\n');
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `edit-sync-test-log-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            log('ğŸ“„ æ—¥èªŒå·²å°å‡º');
        }
    </script>
</body>
</html>