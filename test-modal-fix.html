<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½ˆè·³çª—å£ä¿®å¾©æ¸¬è©¦</title>
    <link rel="stylesheet" href="src/styles/components.css">
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .log-container {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-entry.error {
            color: #dc3545;
        }
        
        .log-entry.success {
            color: #28a745;
        }
        
        .log-entry.info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ å½ˆè·³çª—å£ä¿®å¾©æ¸¬è©¦</h1>
        <p>æ­¤é é¢ç”¨æ–¼æ¸¬è©¦å’Œä¿®å¾©æ–°å¢/ç·¨è¼¯é£Ÿå“å’Œè¨‚é–±æ™‚å½ˆè·³çª—å£ç„¡æ•…æ¶ˆå¤±çš„å•é¡Œã€‚</p>
        
        <div class="test-section">
            <h3>ğŸ§ª åŸºæœ¬æ¨¡æ…‹æ¡†æ¸¬è©¦</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testBasicModal()">æ¸¬è©¦åŸºæœ¬æ¨¡æ…‹æ¡†</button>
                <button class="btn btn-info" onclick="testMultipleModals()">æ¸¬è©¦å¤šå€‹æ¨¡æ…‹æ¡†</button>
                <button class="btn btn-warning" onclick="testModalWithForm()">æ¸¬è©¦è¡¨å–®æ¨¡æ…‹æ¡†</button>
                <button class="btn btn-danger" onclick="debugModal.closeAllModals()">é—œé–‰æ‰€æœ‰æ¨¡æ…‹æ¡†</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ é£Ÿå“ç®¡ç†æ¸¬è©¦</h3>
            <div class="test-buttons">
                <button class="btn btn-success" onclick="testFoodAdd()">æ¸¬è©¦æ–°å¢é£Ÿå“</button>
                <button class="btn btn-primary" onclick="testFoodEdit()">æ¸¬è©¦ç·¨è¼¯é£Ÿå“</button>
                <button class="btn btn-info" onclick="testFoodView()">æ¸¬è©¦æŸ¥çœ‹é£Ÿå“è©³æƒ…</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š è¨‚é–±ç®¡ç†æ¸¬è©¦</h3>
            <div class="test-buttons">
                <button class="btn btn-success" onclick="testSubscriptionAdd()">æ¸¬è©¦æ–°å¢è¨‚é–±</button>
                <button class="btn btn-primary" onclick="testSubscriptionEdit()">æ¸¬è©¦ç·¨è¼¯è¨‚é–±</button>
                <button class="btn btn-info" onclick="testSubscriptionView()">æ¸¬è©¦æŸ¥çœ‹è¨‚é–±è©³æƒ…</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ” èª¿è©¦å·¥å…·</h3>
            <div class="test-buttons">
                <button class="btn btn-info" onclick="debugModal.listModals()">åˆ—å‡ºæ‰€æœ‰æ¨¡æ…‹æ¡†</button>
                <button class="btn btn-warning" onclick="analyzeModalState()">åˆ†ææ¨¡æ…‹æ¡†ç‹€æ…‹</button>
                <button class="btn btn-primary" onclick="fixModalIssues()">é‡æ–°æ‡‰ç”¨ä¿®å¾©</button>
                <button class="btn btn-danger" onclick="clearLogs()">æ¸…é™¤æ—¥èªŒ</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“‹ æ¸¬è©¦æ—¥èªŒ</h3>
            <div id="log-container" class="log-container">
                <div class="log-entry info">ç­‰å¾…æ¸¬è©¦é–‹å§‹...</div>
            </div>
        </div>
        
        <div id="status" class="status info">
            ç³»çµ±å·²æº–å‚™å°±ç·’ï¼Œè«‹é–‹å§‹æ¸¬è©¦
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="contentful-config.js"></script>
    <script src="src/js/contentfulManager.js"></script>
    <script src="src/js/crudManager.js"></script>
    <script src="src/js/components.js"></script>
    <script src="src/js/app.js"></script>
    <script src="fix-modal-disappearing.js"></script>
    
    <script>
        // æ—¥èªŒç³»çµ±
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function clearLogs() {
            document.getElementById('log-container').innerHTML = '';
            log('æ—¥èªŒå·²æ¸…é™¤', 'info');
        }
        
        // åŸºæœ¬æ¸¬è©¦å‡½æ•¸
        function testBasicModal() {
            log('é–‹å§‹æ¸¬è©¦åŸºæœ¬æ¨¡æ…‹æ¡†', 'info');
            try {
                if (window.app && window.app.showModal) {
                    window.app.showModal('test-basic', 'åŸºæœ¬æ¸¬è©¦æ¨¡æ…‹æ¡†', `
                        <p>é€™æ˜¯ä¸€å€‹åŸºæœ¬çš„æ¸¬è©¦æ¨¡æ…‹æ¡†ã€‚</p>
                        <p>è«‹æ¸¬è©¦ä»¥ä¸‹æ“ä½œï¼š</p>
                        <ul>
                            <li>é»æ“ŠèƒŒæ™¯æ˜¯å¦æœƒé—œé–‰æ¨¡æ…‹æ¡†</li>
                            <li>é»æ“Š X æŒ‰éˆ•æ˜¯å¦æœƒé—œé–‰æ¨¡æ…‹æ¡†</li>
                            <li>æŒ‰ ESC éµæ˜¯å¦æœƒé—œé–‰æ¨¡æ…‹æ¡†</li>
                        </ul>
                        <button class="btn btn-primary" onclick="log('æ¨¡æ…‹æ¡†å…§æŒ‰éˆ•é»æ“Šæ­£å¸¸', 'success')">æ¸¬è©¦æŒ‰éˆ•</button>
                    `);
                    log('åŸºæœ¬æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('åŸºæœ¬æ¨¡æ…‹æ¡†æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– showModal æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`åŸºæœ¬æ¨¡æ…‹æ¡†æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('åŸºæœ¬æ¨¡æ…‹æ¡†æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        function testMultipleModals() {
            log('é–‹å§‹æ¸¬è©¦å¤šå€‹æ¨¡æ…‹æ¡†', 'info');
            try {
                if (window.app && window.app.showModal) {
                    window.app.showModal('test-multi-1', 'ç¬¬ä¸€å€‹æ¨¡æ…‹æ¡†', `
                        <p>é€™æ˜¯ç¬¬ä¸€å€‹æ¨¡æ…‹æ¡†</p>
                        <button class="btn btn-primary" onclick="testSecondModal()">æ‰“é–‹ç¬¬äºŒå€‹æ¨¡æ…‹æ¡†</button>
                    `);
                    log('ç¬¬ä¸€å€‹æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('å¤šæ¨¡æ…‹æ¡†æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– showModal æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`å¤šæ¨¡æ…‹æ¡†æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('å¤šæ¨¡æ…‹æ¡†æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        function testSecondModal() {
            log('é¡¯ç¤ºç¬¬äºŒå€‹æ¨¡æ…‹æ¡†', 'info');
            window.app.showModal('test-multi-2', 'ç¬¬äºŒå€‹æ¨¡æ…‹æ¡†', `
                <p>é€™æ˜¯ç¬¬äºŒå€‹æ¨¡æ…‹æ¡†</p>
                <p>ç¬¬ä¸€å€‹æ¨¡æ…‹æ¡†æ‡‰è©²ä»ç„¶å­˜åœ¨</p>
                <button class="btn btn-secondary" onclick="app.closeModal('test-multi-2')">é—œé–‰æ­¤æ¨¡æ…‹æ¡†</button>
            `);
        }
        
        function testModalWithForm() {
            log('é–‹å§‹æ¸¬è©¦è¡¨å–®æ¨¡æ…‹æ¡†', 'info');
            try {
                if (window.app && window.app.showModal) {
                    window.app.showModal('test-form', 'è¡¨å–®æ¸¬è©¦æ¨¡æ…‹æ¡†', `
                        <form id="test-form" onsubmit="handleTestFormSubmit(event)">
                            <div style="margin-bottom: 15px;">
                                <label>æ¸¬è©¦è¼¸å…¥ï¼š</label>
                                <input type="text" name="testInput" placeholder="è«‹è¼¸å…¥æ¸¬è©¦å…§å®¹" style="width: 100%; padding: 8px; margin-top: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label>æ¸¬è©¦é¸æ“‡ï¼š</label>
                                <select name="testSelect" style="width: 100%; padding: 8px; margin-top: 5px;">
                                    <option value="option1">é¸é … 1</option>
                                    <option value="option2">é¸é … 2</option>
                                    <option value="option3">é¸é … 3</option>
                                </select>
                            </div>
                            <div style="text-align: right;">
                                <button type="button" class="btn btn-secondary" onclick="app.closeModal('test-form')">å–æ¶ˆ</button>
                                <button type="submit" class="btn btn-primary">æäº¤</button>
                            </div>
                        </form>
                    `);
                    log('è¡¨å–®æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('è¡¨å–®æ¨¡æ…‹æ¡†æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– showModal æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`è¡¨å–®æ¨¡æ…‹æ¡†æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('è¡¨å–®æ¨¡æ…‹æ¡†æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        function handleTestFormSubmit(event) {
            event.preventDefault();
            log('è¡¨å–®æäº¤äº‹ä»¶è§¸ç™¼', 'info');
            
            const formData = new FormData(event.target);
            const data = {
                testInput: formData.get('testInput'),
                testSelect: formData.get('testSelect')
            };
            
            log(`è¡¨å–®æ•¸æ“š: ${JSON.stringify(data)}`, 'success');
            updateStatus('è¡¨å–®æäº¤æˆåŠŸï¼Œæ¨¡æ…‹æ¡†æ‡‰è©²ä¿æŒé–‹å•Ÿ', 'success');
        }
        
        // é£Ÿå“ç®¡ç†æ¸¬è©¦
        function testFoodAdd() {
            log('é–‹å§‹æ¸¬è©¦æ–°å¢é£Ÿå“', 'info');
            try {
                if (window.app && window.app.showFoodForm) {
                    window.app.showFoodForm();
                    log('æ–°å¢é£Ÿå“æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('æ–°å¢é£Ÿå“æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– showFoodForm æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`æ–°å¢é£Ÿå“æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('æ–°å¢é£Ÿå“æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        function testFoodEdit() {
            log('é–‹å§‹æ¸¬è©¦ç·¨è¼¯é£Ÿå“', 'info');
            try {
                if (window.app && window.app.showFoodForm) {
                    // ä½¿ç”¨æ¨¡æ“¬çš„é£Ÿå“ ID
                    window.app.showFoodForm(1);
                    log('ç·¨è¼¯é£Ÿå“æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('ç·¨è¼¯é£Ÿå“æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– showFoodForm æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`ç·¨è¼¯é£Ÿå“æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('ç·¨è¼¯é£Ÿå“æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        function testFoodView() {
            log('é–‹å§‹æ¸¬è©¦æŸ¥çœ‹é£Ÿå“è©³æƒ…', 'info');
            try {
                if (window.app && window.app.viewFoodDetails) {
                    window.app.viewFoodDetails(1);
                    log('é£Ÿå“è©³æƒ…æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('æŸ¥çœ‹é£Ÿå“è©³æƒ…æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– viewFoodDetails æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`æŸ¥çœ‹é£Ÿå“è©³æƒ…æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('æŸ¥çœ‹é£Ÿå“è©³æƒ…æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // è¨‚é–±ç®¡ç†æ¸¬è©¦
        function testSubscriptionAdd() {
            log('é–‹å§‹æ¸¬è©¦æ–°å¢è¨‚é–±', 'info');
            try {
                if (window.app && window.app.showSubscriptionForm) {
                    window.app.showSubscriptionForm();
                    log('æ–°å¢è¨‚é–±æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('æ–°å¢è¨‚é–±æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– showSubscriptionForm æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`æ–°å¢è¨‚é–±æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('æ–°å¢è¨‚é–±æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        function testSubscriptionEdit() {
            log('é–‹å§‹æ¸¬è©¦ç·¨è¼¯è¨‚é–±', 'info');
            try {
                if (window.app && window.app.showSubscriptionForm) {
                    window.app.showSubscriptionForm(1);
                    log('ç·¨è¼¯è¨‚é–±æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('ç·¨è¼¯è¨‚é–±æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– showSubscriptionForm æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`ç·¨è¼¯è¨‚é–±æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('ç·¨è¼¯è¨‚é–±æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        function testSubscriptionView() {
            log('é–‹å§‹æ¸¬è©¦æŸ¥çœ‹è¨‚é–±è©³æƒ…', 'info');
            try {
                if (window.app && window.app.viewSubscriptionDetails) {
                    window.app.viewSubscriptionDetails(1);
                    log('è¨‚é–±è©³æƒ…æ¨¡æ…‹æ¡†å·²é¡¯ç¤º', 'success');
                    updateStatus('æŸ¥çœ‹è¨‚é–±è©³æƒ…æ¸¬è©¦é€²è¡Œä¸­', 'info');
                } else {
                    throw new Error('App æˆ– viewSubscriptionDetails æ–¹æ³•ä¸å­˜åœ¨');
                }
            } catch (error) {
                log(`æŸ¥çœ‹è¨‚é–±è©³æƒ…æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                updateStatus('æŸ¥çœ‹è¨‚é–±è©³æƒ…æ¸¬è©¦å¤±æ•—', 'error');
            }
        }
        
        // èª¿è©¦å·¥å…·
        function analyzeModalState() {
            log('é–‹å§‹åˆ†ææ¨¡æ…‹æ¡†ç‹€æ…‹', 'info');
            
            const modals = document.querySelectorAll('.modal');
            log(`æ‰¾åˆ° ${modals.length} å€‹æ¨¡æ…‹æ¡†`, 'info');
            
            modals.forEach((modal, index) => {
                const info = {
                    id: modal.id,
                    visible: modal.classList.contains('show'),
                    display: window.getComputedStyle(modal).display,
                    zIndex: window.getComputedStyle(modal).zIndex,
                    hasClickListener: modal.onclick !== null
                };
                log(`æ¨¡æ…‹æ¡† ${index + 1}: ${JSON.stringify(info)}`, 'info');
            });
            
            // æª¢æŸ¥æ˜¯å¦æœ‰é‡è¤‡çš„äº‹ä»¶ç›£è½å™¨
            const forms = document.querySelectorAll('form');
            log(`æ‰¾åˆ° ${forms.length} å€‹è¡¨å–®`, 'info');
            
            updateStatus('æ¨¡æ…‹æ¡†ç‹€æ…‹åˆ†æå®Œæˆï¼Œè«‹æŸ¥çœ‹æ—¥èªŒ', 'success');
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ', 'success');
            
            // ç­‰å¾…æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–
            setTimeout(() => {
                if (window.app) {
                    log('æ‡‰ç”¨ç¨‹å¼å·²åˆå§‹åŒ–', 'success');
                    updateStatus('ç³»çµ±å·²æº–å‚™å°±ç·’ï¼Œå¯ä»¥é–‹å§‹æ¸¬è©¦', 'success');
                } else {
                    log('æ‡‰ç”¨ç¨‹å¼æœªåˆå§‹åŒ–', 'error');
                    updateStatus('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—', 'error');
                }
                
                if (window.fixModalIssues) {
                    log('æ¨¡æ…‹æ¡†ä¿®å¾©è…³æœ¬å·²è¼‰å…¥', 'success');
                } else {
                    log('æ¨¡æ…‹æ¡†ä¿®å¾©è…³æœ¬æœªè¼‰å…¥', 'error');
                }
                
                if (window.debugModal) {
                    log('èª¿è©¦å·¥å…·å·²å¯ç”¨', 'success');
                } else {
                    log('èª¿è©¦å·¥å…·ä¸å¯ç”¨', 'error');
                }
            }, 2000);
        });
    </script>
</body>
</html>